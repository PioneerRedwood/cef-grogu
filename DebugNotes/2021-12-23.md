# 디버깅 노트

# 시작은 간단하게
- cefsimple에다가 cefclient의 몇 개의 기능을 가져오는 것
    - 메뉴바
    - URL 요청/응답
    - 
- Windows만 진행하므로 Linux, Mac를 지원하는 크로스-플랫폼 기능은 전부 삭제한다.

## 클래스 구조
- CEF는 각 클래스를 계층에 맞게 설계했던 부분이 눈에 띄었다.
- 처음엔 이해하기 어려웠지만 설계 패턴에 익숙해지려고 정리하면서 진행했다.
- 이후에 소개하는 클래스는 아래로 내려갈수록 구체화되는 것이다. (부모 -> 자식 순)

## 설명
- 프로그램은 context로 시작해서 끝난다. Windows이므로 wWinMain함수를 사용한다.
- 함수에 들어가는 매개변수는 적지 않는다.
- 다음은 순서대로 클래스 함수, 클래스 변수, 구조체 내의 멤버들을 표로 나타낸 형식이다.

    |접근제한자|키워드|반환 타입|이름|설명|
    |---|---|---|---|---|


    |접근제한자|키워드|타입|이름|설명|
    |---|---|---|---|---|


    |타입|이름|설명|
    |--|--|--|


### 핵심 클래스
- MainContext
- MainContextImpl
- RootWindowManager
- RootWindow
- CefClient, 다수의 핸들러 클래스 -> ClientHandler -> BrowserWindow

## MainContext
- Maincontext는 어플리케이션의 전반적인 흐름을 지니는 클래스
- MainContext::Get()을 통해 접근 가능
- MainContext는 전역 인스턴스로 존재하며, 이의 구현 클래스는 MainContextImpl

### 클래스 멤버 함수
|접근제한자|키워드|반환|이름|설명|
|-------|--------|----------|-----------|-----------|
|public|static|MainContext*|Get()|자신의 전역 포인터 객체를 반환|
|public|virtual|string|GetConsoleLogPath()|콘솔 로그의 경로를 반환|
|public|virtual|string|GetDownloadPath()|파일의 전체 경로를 반환
|public|virtual|string|GetAppWorkingDirectory()|앱 작업 디렉토리 반환
|public|virtual|string|GetMainURL()|메인 어플리케이션 URL 반환
|public|virtual|cef_color_t|GetBackgroundColor()|배경색 반환
|public|virtual|bool|UseChromeRuntime()|크롬 런타임이 사용되면 true, 아니면 false
|public|virtual|bool|UseViews()|Views 프레임워크가 사용되면 true, 아니면 false
|public|virtual|bool|UseWindowlessRendering()|OSR이 사용되면 true, 아니면 false
|public|virtual|bool|TouchEventEnabled()|터치 이벤트가 사용되면 true, 아니면 false
|public|virtual|bool|PopulateSettings()|명령줄 인수에 따라 settings를 설정
|public|virtual|bool|PopulateBrowserSettings()|명령줄 인수에 따라 settings를 설정
|public|virtual|bool|PopulateOSRSettings()|명령줄 인수에 따라 settings를 설정
|public|virtual|RootWindowManager*|GetRootWindowManager()|루트창 매니저 반환
|protected|||MainContext()|생성자
|protected|virtual||~MainContext()|소멸자

## MainContextImpl : public MainContext
MainContext의 오버로딩 함수는 기재하지 않는다

### 클래스 멤버 함수
|접근제한자|키워드|반환 타입|이름|설명|
|---|---|---|---|---|
|public|-|생성자|MainContextImpl()|-
|public|-|bool|Initialize()|CEF 및 메인 컨텍스트 관련된 것들 초기화, 해당 오브젝트를 생성한 동일한 스레드에서 호출돼야 함
|public|-|void|Shutdown()|CEF 및 메인 컨텍스트 관련된 것들 종료, 해당 오브젝트를 생성한 동일한 스레드에서 호출돼야 함
|private|friend|-|-|std::default_delete< MainContextImpl >
|private|-|소멸자|~MainContextImpl()|-
|private|const|bool|InValidState()|컨텍스트가 유효한 상태인지 반환, 초기화되고 종료되지 않았다면 true 아니면 false

### 클래스 멤버 변수
|접근제한자|키워드|타입|이름|설명|
|---|---|---|---|---|
|private|-|CefRefPtr< CefCommandLine >|command_line_|명령줄 정보
|private|const|bool|terminate_when_all_windows_closed_|모든 창이 꺼지면 종료
|private|-|bool|initialized_|컨텍스트 상태 추적
|private|-|bool|shutdown_|컨텍스트 상태 추적
|private|-|string|main_url_|메인 URL
|private|-|cef_color_t|background_color_|배경색
|private|-|cef_color_t|browser_background_color_|브라우저 배경색
|private|-|bool|use_windowless_rendering|osr 설정
|private|-|int|windowless_frame_rate_|osr 일때 프레임률
|private|-|bool|use_chrome_runtime_|크롬 런타임 여부
|private|-|bool|use_views_|views 프레임워크 여부
|private|-|bool|touch_events_enabled_|터치 이벤트 활성화 여부
|private|-|unique_ptr< RootWindowManager >|root_window_manager_|루트창 매니저
|private|-|bool|external_begin_frame_enabled_|
|private|-|base::ThreadChecker|thread_checker_|유효한 스레드에서 호출됐는지에 대한 검사 변수


## RootWindow
브라우저의 최상위(루트) 네이티브 창을 나타낸다.

- RootWindowConfig: 루트창이 어떻게 생성될 지에 대한 설정 구조체

    |타입|이름|설명|
    |--|--|--|
    |-|RootWindowConfig()|생성자|
    |bool|always_on_top|항상 위면 true, 아니면 false|
    |bool|with_controls|제어 버튼 활성화 돼있으면 true, 아니면 false|
    |bool|with_osr|osr 사용하면 true, 아니면 false|
    |bool|with_extension|확장 앱을 호스팅하면 true, 아니면 false|
    |bool|initially_hidden|숨긴 상태로 초기화하면 true, 아니면 false|
    |CefRect|bounds|창의 위치|
    |CefRect|source_bounds|창이 생성될 UI 요소 위치|
    |CefRefPtr< CefWindow >|parent_window|views 프레임워크에서만 사용되는 부모 윈도우|
    |base::OnceClosure||창이 닫힐 때 실행되는 콜백 함수|
    |string|url|처음 로드할 URL

- RootWindow::Delegate 내부 클래스
    |접근제한자|키워드|반환 타입|이름|설명|
    |---|---|---|---|---|
    |public|virtual|CefRefPtr < CefRequestContext >|GetRequestContext()|브라우저에 있는 CefRequestContext를 생성하는데 사용
    |public|virtual|scoped_refptr< ImageCache >|GetImageCache()|이미지 캐시 반환
    |public|virtual|void|OnTest()|테스트 실행되면 호출, resource.h에 등록된 test_id 참고
    |public|virtual|void|OnExit()|어플리케이션을 종료하면 호출
    |public|virtual|void|OnRootWindowDestroyed()|루트창이 파괴되면 호출
    |public|virtual|void|OnRootWindowActivated()|루트창이 활성화되면 호출
    |public|virtual|void|OnBrowserCreated()|루트창에 브라우저가 생성되면 호출
    |public|virtual|void|CreateExtensionWindow()|확장에 대한 창을 생성
    |protected|virtual|-|~Delegate()|소멸자


|접근제한자|키워드|반환 타입|이름|설명|
|---|---|---|---|---|
|public|static|scoped_refptr< RootWindow >|Create()|새로운 루트창 오브젝트 생성
|public|static|scoped_refptr< RootWindow >|GetForBrowser()|브라우저 ID와 관련된 루트창 반환
|public|virtual|void|Init()|일반 창으로 초기화
|public|virtual|void|InitAsPopup()|팝업 창으로 초기화
|public|virtual|void|Show()|창 보이기
|public|virtual|void|Hide()|창 숨기기
|public|virtual|void|SetBounds()|화면 좌표에 맞게 창 위치 설정
|public|virtual|void|Close()|창 닫기
|public|virtual|void|SetDeviceScaleFactor()|장비 스케일 요소 설정, OSR 일때만 사용됨
|public|virtual|float|GetDeviceScaleFactor()|장비 스케일 요소 반환
|public|virtual|CefRefPtr< CefBrowser >|GetBrowser()|현재 창을 포함하는 브라우저 반환
|public|virtual|ClientWindowHandle|GetWindowHandle()|현재 창의 네이티브 핸들을 반환
|public|virtual|bool|OSR을 사용하는 창이면 true, 아니면 false
|public|virtual|bool|확장 앱을 호스팅하는 창이라면 true, 아니면 false
|public|virtual|void|OnExtensionChanged()|로드된 확장이 변경되면 호출



## RootWindowManager : public RootWindow::Delegate
- 루트창 인스턴스를 생성하고 관리하는데 사용된다.
- RootWindow의 내부 클래스인 RootWindow::Delegate를 구현한다, 오버로딩 함수는 기재하지 않는다.
### 함수
|접근제한자|키워드|반환 타입|이름|설명|
|---|---|---|---|---|
|public|explicit|생성자|RootWindowManager()|생성자

- 계속 진행할 예정


## CefClient


## ClientHandler


## BrowserWindow

